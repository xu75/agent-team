<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cat Cafe Timeline</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <main id="appLayout" class="layout">
        <aside class="panel left-panel">
          <div class="column-top brand-top">
            <span class="paw">●</span>
            <h1>Cat Café</h1>
          </div>
          <div class="panel-title-row">
            <h2>对话</h2>
            <button id="newChatBtn" class="btn primary">新对话</button>
          </div>
          <input id="taskSearch" class="search" placeholder="搜索对话..." />
          <div id="taskList" class="task-list"></div>
        </aside>

        <section class="panel center-panel">
          <div class="column-top center-top">
            <h2 id="taskTitle">对话</h2>
            <div class="top-icon-actions">
              <button id="exportReportBtn" class="icon-btn" title="导出报告" aria-label="导出报告">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M8 3h6l5 5v13a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1Z" />
                  <path d="M14 3v5h5" />
                  <path d="M10 12h7M10 16h7M10 8h3" />
                </svg>
              </button>
              <button id="exportChatImageBtn" class="icon-btn" title="导出长图" aria-label="导出长图">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <rect x="3" y="5" width="18" height="14" rx="2" />
                  <path d="M7 14l3-3 3 3 3-4 2 3" />
                  <circle cx="9" cy="9" r="1.2" />
                </svg>
              </button>
              <button id="cancelRunBtn" class="icon-btn danger" title="终止运行" aria-label="终止运行">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <rect x="7" y="7" width="10" height="10" rx="1.5" />
                </svg>
              </button>
              <button
                id="toggleRightPanelBtn"
                class="icon-btn"
                title="隐藏状态栏"
                aria-label="隐藏状态栏"
                aria-pressed="false"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <rect x="3" y="4" width="18" height="16" rx="2" />
                  <path d="M15 4v16" />
                  <path d="M11 12h2" />
                </svg>
              </button>
              <button id="moreActionsBtn" class="icon-btn" title="更多操作" aria-label="更多操作">⋯</button>
            </div>
            <div id="moreActionsMenu" class="more-actions-menu" aria-hidden="true">
              <button data-action="copy-task-id">复制任务ID</button>
              <button data-action="export-page-image">导出整页长图</button>
              <button data-action="rerun-task">重跑任务</button>
              <button data-action="clear-round-filter">清除回合筛选</button>
            </div>
          </div>
          <div id="chatStream" class="chat-stream"></div>
          <button id="jumpBottomBtn" class="jump-bottom-btn" title="回到最新消息" aria-label="回到最新消息">
            ↓ 回到最新
          </button>
          <aside id="evidenceDrawer" class="evidence-drawer" aria-hidden="true">
            <div class="drawer-head">
              <strong id="evidenceDrawerTitle">证据</strong>
              <button id="evidenceDrawerClose" class="btn">关闭</button>
            </div>
            <div id="evidenceDrawerKinds" class="drawer-kinds"></div>
            <pre id="evidenceDrawerBody" class="drawer-body">点击消息中的“证据”按钮查看。</pre>
          </aside>

          <div class="composer">
            <div class="composer-input-wrap">
              <input id="chatCommandInput" placeholder='输入命令，如：/task 实现登录接口；/task --provider codex-cli --rounds 2 修复失败测试；/rerun 继续上个任务' />
              <div id="mentionSuggest" class="mention-suggest" aria-hidden="true"></div>
            </div>
            <button id="sendCommandBtn" class="btn primary">发送</button>
          </div>
          <div id="runTaskStatus" class="run-status"></div>
        </section>

        <aside class="panel right-panel">
          <div class="column-top right-top">
            <h2>状态栏</h2>
            <span id="rightRuntimeHint" class="runtime-hint">空闲</span>
          </div>
          <section id="flowCard">
          <div class="flow-title-row">
            <h3>流程状态</h3>
            <span id="flowTaskIdHint" class="flow-task-id">Task: -</span>
          </div>
          <div class="status-flow-head">
            <span id="taskMeta" class="meta-pill">未选择任务</span>
          </div>
          <div id="timeline" class="timeline-strip"></div>
          <div id="liveStage" class="live-stage"></div>
          </section>

          <h3>Agent 状态</h3>
          <div id="agentStatus" class="agent-status"></div>

          <h3>任务统计</h3>
          <div class="stat-grid" id="stats"></div>

          <h3>最近失败</h3>
          <pre id="latestFailure" class="plain-block"></pre>

          <h3>测试结果</h3>
          <pre id="testResults" class="plain-block"></pre>

          <h3>证据查看</h3>
          <div id="evidenceMeta" class="evidence-meta">点击消息卡里的 Evidence 按钮查看。</div>
          <pre id="evidenceViewer" class="plain-block"></pre>

          <h3>未解决项</h3>
          <ul id="mustFixList" class="simple-list"></ul>

          <h3>角色定义</h3>
          <div id="roleConfigPanel" class="role-config-panel"></div>
          <div class="role-actions">
            <button id="saveRolesBtn" class="btn">保存角色配置</button>
          </div>
        </aside>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@14/marked.min.js"></script>
    <script src="/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  </body>
</html>
